{% extends "quiz/base.html" %}
{% block content %}

<style>
  /* ---------- Dashboard Enhancements ---------- */
  .stat-card {
    border-radius: 12px;
    transition: transform .15s ease, box-shadow .15s ease;
  }
  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,.08);
  }

  .stat-value {
    font-size: 1.8rem;
    font-weight: 700;
  }

  .muted {
    color: #7a7a7a;
    font-size: .8rem;
  }

  .badge {
    padding: 4px 10px;
    border-radius: 999px;
    font-size: .75rem;
    font-weight: 600;
  }

  .badge-green { background: #e6f7ef; color: #157347; }
  .badge-yellow { background: #fff3cd; color: #856404; }
  .badge-red { background: #fdecea; color: #842029; }

  @media (max-width: 768px) {
    .stat-value {
      font-size: 1.4rem;
    }
  }
</style>

<!-- ================================================= -->
<!-- HEADER -->
<!-- ================================================= -->
<div class="mb-5 is-flex is-justify-content-space-between is-align-items-center">

  <div>
    <h2 class="title is-4 mb-1">ğŸ›  Admin Dashboard</h2>
    <p class="muted">
      Platform health, learning performance & subscription insights
    </p>
  </div>
</div>



<!-- ================================================= -->
<!-- MOCK MANAGEMENT QUICK ACTIONS -->
<!-- ================================================= -->
{% if user.is_staff %}
<div class="box mb-6">

  <h3 class="title is-5 mb-3">ğŸ’³ Question and Mock Management</h3>
  <p class="muted mb-4">
    Manage Questions and Mock
  </p>
  <div class="buttons is-flex-wrap-wrap">

    <a href="{% url 'quiz:admin_mock_attempts' %}"
       class="button is-link is-light">
       ğŸ§ª Manage Mock Attempts
    </a>


     <a href="{% url 'quiz:question_dashboard' %}"
       class="button is-link is-light">
      ğŸ“š Manage Questions
    </a>  

   
  </div>

</div>
{% endif %}



<!-- ================================================= -->
<!-- SUBSCRIPTION MANAGEMENT QUICK ACTIONS -->
<!-- ================================================= -->
{% if user.is_staff %}
<div class="box mb-6">

  <h3 class="title is-5 mb-3">ğŸ’³ Subscription Management</h3>
  <p class="muted mb-4">
    Manage exams, tracks, pricing, coupons, payments & user access
  </p>

  <div class="buttons is-flex-wrap-wrap">

    <a href="{% url 'quiz:subscription_admin_panel' %}"
       class="button is-link is-light">
      ğŸ§¾ Subscription Panel
    </a>

 <a href="{% url 'quiz:admin_track_list' %}"
       class="button is-primary is-light">
      ğŸ“š Manage Tracks
    </a>

    <a href="{% url 'quiz:admin_coupon_list' %}"
       class="button is-warning is-light">
      ğŸŸ Coupons
    </a>


    <a href="{% url 'quiz:admin_exam_list' %}"
       class="button is-info is-light">
      ğŸ“ Manage Exams
    </a>

   

    <a href="{% url 'quiz:admin_payment_list' %}"
       class="button is-success is-light">
      ğŸ’° Payments
    </a>

  </div>

</div>
{% endif %}


<!-- ================================================= -->
<!-- KPI ROW -->
<!-- ================================================= -->
<div class="columns is-multiline">

  <div class="column is-6-mobile is-3-tablet">
  <div class="box stat-card has-text-centered">
    <p class="heading">â“ Questions</p>
    <p class="stat-value has-text-primary">{{ total_questions }}</p>
    <p class="muted">Active questions</p>
  </div>
</div>


  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">ğŸ‘¥ Users</p>
      <p class="stat-value">{{ total_users }}</p>
      <p class="muted">Registered learners</p>
    </div>
  </div>

  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">ğŸ“ Attempts</p>
      <p class="stat-value">{{ total_attempts }}</p>
      <p class="muted">Submitted exams</p>
    </div>
  </div>

  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">âœ… Pass Rate</p>
      <p class="stat-value has-text-success">{{ pass_rate }}%</p>
      <p class="muted">Success ratio</p>
    </div>
  </div>

  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">ğŸ“Š Avg Score</p>
      <p class="stat-value has-text-info">
        {% if avg_score %}{{ avg_score }}%{% else %}â€”{% endif %}
      </p>
      <p class="muted">Across all exams</p>
    </div>
  </div>

</div>

<!-- ================================================= -->
<!-- SUBSCRIPTION SUMMARY -->
<!-- ================================================= -->
<h3 class="title is-5 mt-6 mb-3">ğŸ’³ Subscriptions Overview</h3>

<div class="columns is-multiline">

  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">ğŸ“¦ Total</p>
      <p class="stat-value">{{ total_track_subs }}</p>
      <p class="muted">All subscriptions</p>
    </div>
  </div>

  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">ğŸŸ¢ Active</p>
      <p class="stat-value has-text-success">{{ active_track_subs }}</p>
      <p class="muted">Currently valid</p>
    </div>
  </div>

  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">â³ Expiring</p>
      <p class="stat-value has-text-warning">{{ expiring_soon }}</p>
      <p class="muted">Next 7 days</p>
    </div>
  </div>

  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">ğŸ”´ Expired</p>
      <p class="stat-value has-text-danger">{{ expired_track_subs }}</p>
      <p class="muted">Needs renewal</p>
    </div>
  </div>

</div>

<!-- ================================================= -->
<!-- REVENUE & CONVERSION -->
<!-- ================================================= -->
<h3 class="title is-5 mt-6 mb-3">ğŸ“ˆ Revenue & Conversion</h3>

<div class="columns is-multiline">

  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">ğŸ†“ Trial Users</p>
      <p class="stat-value">{{ trial_subs }}</p>
      <p class="muted">7-day trial</p>
    </div>
  </div>

  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">ğŸ’° Paid Users</p>
      <p class="stat-value has-text-success">{{ paid_subs }}</p>
      <p class="muted">Converted</p>
    </div>
  </div>

  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">ğŸ” Conversion</p>
      <p class="stat-value has-text-primary">{{ conversion_rate }}%</p>
      <p class="muted">Trial â†’ Paid</p>
    </div>
  </div>

  <div class="column is-6-mobile is-3-tablet">
    <div class="box stat-card has-text-centered">
      <p class="heading">ğŸ’¸ Revenue</p>
      <p class="stat-value has-text-success">â‚¹{{ total_revenue }}</p>
      <p class="muted">ARPU â‚¹{{ arpu }}</p>
    </div>
  </div>

</div>

<!-- ================================================= -->
<!-- TRACK ANALYTICS -->
<!-- ================================================= -->
<h3 class="title is-5 mt-6 mb-3">ğŸ“š Track Analytics</h3>

<div class="table-container">
  <table class="table is-fullwidth is-hoverable is-striped">
    <thead>
      <tr>
        <th>Track</th>
        <th>Enrolled</th>
        <th>Completed</th>
        <th>Completion</th>
        <th>Avg Score</th>
        <th>Revenue</th>
        <th>Drop-off</th>
      </tr>
    </thead>
    <tbody>
      {% for row in track_rows %}
      <tr>
        <td><strong>{{ row.track.title }}</strong></td>
        <td>{{ row.enrolled }}</td>
        <td>{{ row.completed }}</td>
        <td>
          <span class="badge badge-green">
            {{ row.completion_rate }}%
          </span>
        </td>
        <td>
          {% if row.avg_score %}
            {{ row.avg_score }}%
          {% else %}
            â€”
          {% endif %}
        </td>
        <td>â‚¹{{ row.revenue }}</td>
        <td>
          {% if row.drop_exam != "â€”" %}
            <span class="badge badge-red">{{ row.drop_exam }}</span>
          {% else %}
            â€”
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
