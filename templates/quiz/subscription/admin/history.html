{% extends "layouts/base.html" %}
{% block content %}

<h1 class="title is-4">üìú Subscription History</h1>
<p class="has-text-grey mb-5">
  View your active, expired, and past subscriptions
</p>

<!-- ================= TRACK SUBSCRIPTIONS ================= -->
<h2 class="title is-5">üìö Track Subscriptions</h2>

<table class="table is-fullwidth is-striped">
  <thead>
    <tr>
      <th>Track</th>
      <th>Status</th>
      <th>Amount</th>
      <th>Subscribed On</th>
      <th>Expires On</th>
    </tr>
  </thead>
  <tbody>
    {% for sub in track_subs %}
    <tr>
      <td>{{ sub.track.title }}</td>
      <td>
        {% if not sub.is_active %}
          <span class="tag is-danger is-light">Revoked</span>
        {% elif sub.expires_at and sub.expires_at < now %}
          <span class="tag is-warning is-light">Expired</span>
        {% else %}
          <span class="tag is-success is-light">Active</span>
        {% endif %}
      </td>
      <td>‚Çπ{{ sub.amount|default:"0" }}</td>
      <td>{{ sub.subscribed_at|date:"M d, Y" }}</td>
      <td>
        {% if sub.expires_at %}
          {{ sub.expires_at|date:"M d, Y" }}
        {% else %}
          Lifetime
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5" class="has-text-grey">
        No track subscriptions yet
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<hr>

<!-- ================= EXAM SUBSCRIPTIONS ================= -->
<h2 class="title is-5">üìù Exam Subscriptions</h2>

<table class="table is-fullwidth is-striped">
  <thead>
    <tr>
      <th>Exam</th>
      <th>Status</th>
      <th>Amount</th>
      <th>Subscribed On</th>
      <th>Expires On</th>
    </tr>
  </thead>
  <tbody>
    {% for sub in exam_subs %}
    <tr>
      <td>{{ sub.exam.title }}</td>
      <td>
        {% if not sub.is_active %}
          <span class="tag is-danger is-light">Revoked</span>
        {% elif sub.expires_at and sub.expires_at < now %}
          <span class="tag is-warning is-light">Expired</span>
        {% else %}
          <span class="tag is-success is-light">Active</span>
        {% endif %}
      </td>
      <td>‚Çπ{{ sub.amount|default:"0" }}</td>
      <td>{{ sub.subscribed_at|date:"M d, Y" }}</td>
      <td>
        {% if sub.expires_at %}
          {{ sub.expires_at|date:"M d, Y" }}
        {% else %}
          Lifetime
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5" class="has-text-grey">
        No exam subscriptions yet
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<hr>

<!-- ================= PAYMENT HISTORY ================= -->
<h2 class="title is-5">üí≥ Payment History</h2>

<table class="table is-fullwidth is-striped">
  <thead>
    <tr>
      <th>Item</th>
      <th>Amount</th>
      <th>Method</th>
      <th>Reference</th>
      <th>Date</th>
    </tr>
  </thead>
  <tbody>
    {% for p in payments %}
    <tr>
      <td>
        {% if p.track %}
          {{ p.track.title }}
        {% elif p.exam %}
          {{ p.exam.title }}
        {% else %}
          ‚Äî
        {% endif %}
      </td>
      <td>‚Çπ{{ p.amount }}</td>
      <td>{{ p.get_payment_method_display }}</td>
      <td>{{ p.reference_id|default:"‚Äî" }}</td>
      <td>{{ p.paid_at|date:"M d, Y H:i" }}</td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5" class="has-text-grey">
        No payments found
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
