{% extends "quiz/base.html" %}
{% block content %}

<h2 class="title is-4">ðŸ“š Available Exam Tracks</h2>
<p class="has-text-grey mb-4">
  Subscribe to unlock exams.
</p>



{% for track, items in track_map.items %}
<div class="box">
  <h3>{{ track.title }}</h3>
  <p>{{ items|length }} Levels â€¢ Subscription: {{ track.subscription_scope|title }}</p>

  {% if track.subscription_scope == "track" %}
    {% if items.0.is_track_subscribed %}
      <span class="tag is-success">âœ” Subscribed</span>
    {% else %}
      <form method="post" action="{% url 'quiz:subscribe_track' track.id %}">
        {% csrf_token %}
        <button class="button is-primary">Subscribe Track</button>
      </form>
    {% endif %}
  {% endif %}

  <hr>

  {% for item in items %}
    <p>
      <strong>Level {{ item.exam.level }}</strong> â€¢
      {{ item.exam.question_count }} questions â€¢ {{ item.exam.duration_seconds }} sec

      {% if track.subscription_scope == "exam" %}
        {% if item.is_exam_subscribed %}
          <span class="tag is-success ml-2">Subscribed</span>
        {% elif item.can_subscribe %}
          <form method="post" action="{% url 'quiz:subscribe_exam' item.exam.id %}" style="display:inline">
            {% csrf_token %}
            <button class="button is-small is-primary ml-2">Subscribe</button>
          </form>
        {% else %}
          <span class="tag is-light ml-2">ðŸ”’ {{ item.locked_reason }}</span>
        {% endif %}
      {% endif %}
    </p>
  {% endfor %}
</div>
{% empty %}
<p>No exams available.</p>
{% endfor %}



{% endblock %}
