{% extends "layouts/admin/base_admin.html" %}
{% load widget_tweaks %}
{% load static %}

{% block head_extra %}
{{ form.media }}
{% endblock %}

{% block title %}Edit Question{% endblock %}

{% block content %}
<div class="container py-5">

  <div class="mb-6">
    <h1 class="title is-3">✏️ Edit Question</h1>
    <p class="subtitle is-6 has-text-grey">
      Update question details and choices
    </p>
  </div>

  <form method="post">
    {% csrf_token %}

    <!-- QUESTION DETAILS -->
    <div class="card mb-5">
      <header class="card-header">
        <p class="card-header-title">Question Details</p>
      </header>

      <div class="card-content">

        {% for field in form %}
          <div class="field mb-4">
            <label class="label">
              {{ field.label }}
              {% if field.field.required %}
                <span class="has-text-danger">*</span>
              {% endif %}
            </label>

            <div class="control">
              {% if field.name == "text" or field.name == "explanation" %}
                {{ field }}
              {% else %}
                {% render_field field class+="input" %}
              {% endif %}
            </div>

            {% if field.errors %}
              <p class="help is-danger">{{ field.errors.0 }}</p>
            {% endif %}
          </div>
        {% endfor %}

      </div>
    </div>

    <!-- CHOICES -->
    <div class="card mb-5">
      <header class="card-header">
        <p class="card-header-title">Answer Choices</p>
      </header>

      <div class="card-content">

        {{ choice_formset.management_form }}

        <table class="table is-fullwidth is-hoverable">
          <thead>
            <tr>
              <th>Choice</th>
              <th>Correct</th>
              <th>Order</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody>
            {% for cform in choice_formset %}
            <tr>
              <td>
                {{ cform.text }}
                {{ cform.id }}
              </td>
              <td>{{ cform.is_correct }}</td>
              <td>{{ cform.order }}</td>
              <td>{{ cform.DELETE }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

      </div>
    </div>

    <!-- ACTIONS -->
    <div class="field is-grouped is-grouped-centered">
      <a href="{% url 'quiz:question_review' question.id %}"
         class="button is-light">
         Cancel
      </a>

      <button type="submit" class="button is-primary">
        Update Question
      </button>
    </div>

  </form>
</div>
{% endblock %}