{% extends "courses/base.html" %}

{% block title %}Edit Lesson{% endblock %}

{% block extra_head %}
{{ form.media }}   <!-- ðŸ”¥ REQUIRED FOR CKEDITOR -->

<style>
/* ================= FORM CARD ================= */

.form-card {
    background: #ffffff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    margin-bottom: 20px;
}

/* Only text-like inputs should be full width */
.form-card input[type="text"],
.form-card input[type="number"],
.form-card input[type="email"],
.form-card input[type="file"],
.form-card input[type="url"],
.form-card select,
.form-card textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    margin-bottom: 12px;
    font-size: 14px;
}

/* Focus styling */
.form-card input:focus,
.form-card select:focus,
.form-card textarea:focus {
    outline: none;
    border-color: #5624d0;
    box-shadow: 0 0 0 2px rgba(86,36,208,0.15);
}

/* ================= CHECKBOX FIX ================= */

/* Prevent checkbox stretching */
.form-card input[type="checkbox"] {
    width: auto !important;
    margin-right: 8px;
    padding: 0;
    vertical-align: middle;
    transform: scale(1.1);
}

/* Checkbox + label alignment */
.checkbox-group {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
}

/* ================= BUTTONS ================= */

.btn-primary {
    background: #5624d0;
    color: white;
    padding: 10px 18px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-size: 14px;
}

.btn-primary:hover {
    background: #401b9c;
}

.btn-secondary {
    margin-left: 10px;
    text-decoration: none;
    padding: 10px 18px;
    border-radius: 6px;
    border: 1px solid #d1d5db;
    color: #374151;
    font-size: 14px;
}

/* ================= CONDITIONAL GROUPS ================= */

.section-group {
    display: none;
}

.section-group.active {
    display: block;
}


</style>
{% endblock %}

{% block content %}

<h2>Edit Lesson</h2>

<p style="color:#6b7280;">
    Course: {{ lesson.section.course.title }} â†’
    Section: {{ lesson.section.title }}
</p>

<form method="post" enctype="multipart/form-data">  <!-- ðŸ”¥ REQUIRED -->
    {% csrf_token %}

    <!-- ================= BASIC INFO ================= -->

    <div class="form-card">
        <h3>Basic Information</h3>

        {{ form.title.label_tag }}
        {{ form.title }}

        {{ form.lesson_type.label_tag }}
        {{ form.lesson_type }}

        {{ form.order.label_tag }}
        {{ form.order }}
    </div>

    <!-- ================= MAIN CONTENT ================= -->

    <div class="form-card">
        <h3>Lesson Content</h3>
        {{ form.article_content.label_tag }}
        {{ form.article_content }}
    </div>

    <!-- ================= VIDEO CONFIG ================= -->

    <div class="form-card section-group" id="video-group">
        <h3>Video Settings</h3>
        {{ form.video_url.label_tag }}
        {{ form.video_url }}
    </div>

    <!-- ================= PRACTICE CONFIG ================= -->
<div class="form-card section-group" id="practice-group">
    <h3>Practice Settings</h3>

    {{ form.practice_domain.label_tag }}
    {{ form.practice_domain }}

    {{ form.practice_category.label_tag }}
    {{ form.practice_category }}

    {{ form.practice_difficulty.label_tag }}
    {{ form.practice_difficulty }}

    {{ form.practice_threshold.label_tag }}
    {{ form.practice_threshold }}

    <div class="checkbox-group">
        {{ form.practice_lock_filters }}
        <label for="{{ form.practice_lock_filters.id_for_label }}">
            Lock filters
        </label>
    </div>

    <div class="checkbox-group">
        {{ form.practice_require_correct }}
        <label for="{{ form.practice_require_correct.id_for_label }}">
            Require correct answers
        </label>
    </div>

    <div class="checkbox-group">
        {{ form.practice_min_accuracy }}
        <label for="{{ form.practice_min_accuracy.id_for_label }}">
            Require minimum accuracy
        </label>
    </div>

</div>

    <!-- ================= QUIZ CONFIG ================= -->

   <div class="form-card section-group" id="quiz-group">
    <h3>Quiz Settings</h3>

    {{ form.exam.label_tag }}
    {{ form.exam }}

    {{ form.quiz_completion_mode.label_tag }}
    {{ form.quiz_completion_mode }}

    {{ form.quiz_min_score.label_tag }}
    {{ form.quiz_min_score }}

    <div class="checkbox-group">
        {{ form.quiz_allow_mock }}
        <label for="{{ form.quiz_allow_mock.id_for_label }}">
            Allow mock attempts
        </label>
    </div>

    {{ form.quiz_max_attempts.label_tag }}
    {{ form.quiz_max_attempts }}
</div>


    <button type="submit" class="btn-primary">
        Save Changes
    </button>

    <a href="{% url 'courses:course_builder' lesson.section.course.slug %}"
       class="btn-secondary">
        Cancel
    </a>

</form>

<script>

function toggleSections() {

    const typeSelect = document.getElementById("id_lesson_type");
    const value = typeSelect.value;

    document.querySelectorAll(".section-group")
        .forEach(el => el.classList.remove("active"));

    if (value === "video")
        document.getElementById("video-group").classList.add("active");

    if (value === "practice")
        document.getElementById("practice-group").classList.add("active");

    if (value === "quiz")
        document.getElementById("quiz-group").classList.add("active");
}

document.addEventListener("DOMContentLoaded", function() {
    toggleSections();
    document.getElementById("id_lesson_type")
            .addEventListener("change", toggleSections);
});

</script>

{% endblock %}
