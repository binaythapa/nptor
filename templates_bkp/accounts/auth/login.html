{% extends "layouts/student/base.html" %}
{% block content %}

<section style="max-width:560px;margin:20px auto;">
  <div class="card-surface" style="padding:20px;">

    <h1 class="title is-4">Sign in</h1>

    {% if error %}
      <div class="notification is-danger">
        {{ error }}
      </div>
    {% endif %}

    {% if expires_in is not None %}
      <p id="otp-timer" class="has-text-grey mb-3">
        Existing OTP expires in <strong></strong>
      </p>
    {% else %}
      <p class="has-text-grey mb-3">
        An OTP will be sent to your email and will expire in 5 minutes.
      </p>
    {% endif %}

    <form method="post" action="{% url 'accounts:request-login-otp' %}">
      {% csrf_token %}

      <div class="field">
        <label class="label">Username or Email</label>
        <div class="control">
          <input
            type="text"
            name="username"
            class="input"
            required
            autofocus
          >
        </div>
      </div>

      <div class="field">
        <label class="label">Password</label>
        <div class="control">
          <input
            type="password"
            name="password"
            class="input"
            required
          >
        </div>
      </div>

      <div class="field is-flex is-justify-content-space-between is-align-items-center">
        <div>
          <a href="{% url 'accounts:password-reset-request' %}">
            Forgot password?
          </a>
        </div>
        <div>
          <button class="button is-primary" type="submit">
            Send OTP
          </button>
        </div>
      </div>
    </form>

    <div style="margin-top:12px" class="small-muted">
  Don't have an account?
  <a href="{% url 'accounts:register' %}">Create one</a>
</div>


  </div>
</section>

{% if expires_in is not None %}
<script>
(function () {
  let remaining = {{ expires_in }};
  const timerEl = document.querySelector("#otp-timer strong");

  function formatTime(s) {
    const m = Math.floor(s / 60);
    const sec = s % 60;
    return `${m}:${sec.toString().padStart(2, "0")}`;
  }

  function tick() {
    if (remaining <= 0) {
      timerEl.textContent = "00:00";
      return;
    }
    timerEl.textContent = formatTime(remaining);
    remaining--;
    setTimeout(tick, 1000);
  }

  tick();
})();
</script>
{% endif %}

{% endblock %}
